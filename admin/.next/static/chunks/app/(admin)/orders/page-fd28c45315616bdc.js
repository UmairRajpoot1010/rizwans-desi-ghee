(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[30],{5417:function(e,s,a){Promise.resolve().then(a.bind(a,5414))},5414:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return h}});var i=a(7437),t=a(2265),n=a(5864);function d(e){var s,a,n,d,l,r,c;let o,m;let{order:h,onUpdate:u}=e,[p,v]=(0,t.useState)(!1),x=(r=h.shippingAddress,c=h.user,r||c?{name:(null==r?void 0:r.name)||(null==c?void 0:c.name),email:(null==r?void 0:r.email)||(null==c?void 0:c.email),phone:(null==r?void 0:r.phone)||(null==c?void 0:c.phone)}:"-");return(0,i.jsxs)("div",{className:"order-card",children:[(0,i.jsxs)("div",{className:"order-card-header",children:[(0,i.jsxs)("div",{className:"order-card-id-amount",children:[(0,i.jsxs)("div",{className:"order-id",children:["Order #",null===(s=h._id)||void 0===s?void 0:s.slice(-8)]}),(0,i.jsx)("div",{className:"order-amount",children:(o=h.totalAmount,"Rs.".concat(Number(o||0).toLocaleString()))})]}),(0,i.jsx)("div",{className:"order-date",children:(m=h.createdAt)?new Date(m).toLocaleDateString():"-"})]}),(0,i.jsxs)("div",{className:"order-card-section",children:[(0,i.jsx)("div",{className:"section-title",children:"Customer"}),(0,i.jsxs)("div",{className:"customer-info",children:[(0,i.jsx)("div",{className:"customer-name",children:x.name||"-"}),(0,i.jsx)("div",{className:"customer-email",children:x.email||"-"}),(0,i.jsx)("div",{className:"customer-phone",children:x.phone||"-"})]})]}),h.shippingAddress&&(0,i.jsxs)("div",{className:"order-card-section",children:[(0,i.jsx)("div",{className:"section-title",children:"Shipping Address"}),(0,i.jsxs)("div",{className:"address-info",children:[(0,i.jsx)("div",{children:h.shippingAddress.address}),(0,i.jsxs)("div",{children:[h.shippingAddress.city,", ",h.shippingAddress.state," ",h.shippingAddress.zipCode]})]})]}),(0,i.jsxs)("div",{className:"order-card-section",children:[(0,i.jsxs)("div",{className:"section-title",children:["Items (",(null===(a=h.items)||void 0===a?void 0:a.length)||0,")"]}),(0,i.jsx)("div",{className:"items-list",children:null===(n=h.items)||void 0===n?void 0:n.map((e,s)=>{var a;return(0,i.jsxs)("div",{className:"item-row",children:[(0,i.jsx)("div",{className:"item-name",children:(null===(a=e.product)||void 0===a?void 0:a.name)||e.product}),(0,i.jsxs)("div",{className:"item-qty",children:["x",e.quantity]}),(0,i.jsxs)("div",{className:"item-price",children:["Rs.",Number(e.price||0).toLocaleString()]})]},s)})})]}),(0,i.jsxs)("div",{className:"order-card-section",children:[(0,i.jsx)("div",{className:"section-title",children:"Payment"}),(0,i.jsxs)("div",{className:"payment-info",children:[(0,i.jsxs)("div",{className:"payment-method",children:[(0,i.jsx)("span",{className:"label",children:"Method:"}),(0,i.jsx)("span",{className:"badge badge-pending",children:"ONLINE"===h.paymentMethod?"Online":"COD"})]}),(0,i.jsxs)("div",{className:"payment-status",children:[(0,i.jsx)("span",{className:"label",children:"Status:"}),(0,i.jsx)("span",{className:"badge badge-payment-".concat(h.paymentStatus||"pending"),children:h.paymentStatus||"pending"})]}),"ONLINE"===h.paymentMethod&&(0,i.jsxs)("div",{className:"payment-verification",children:[(0,i.jsx)("span",{className:"label",children:"Verification:"}),(0,i.jsx)("span",{className:"badge badge-verification-".concat(h.paymentVerificationStatus||"pending"),children:h.paymentVerificationStatus||"pending"})]}),((null===(d=h.paymentProof)||void 0===d?void 0:d.data)||h.paymentScreenshot)&&(0,i.jsx)("div",{className:"payment-screenshot",children:(0,i.jsx)("a",{href:(null===(l=h.paymentProof)||void 0===l?void 0:l.data)||h.paymentScreenshot,target:"_blank",rel:"noreferrer",className:"screenshot-link",children:"View Receipt"})})]})]}),(0,i.jsxs)("div",{className:"order-card-section",children:[(0,i.jsx)("div",{className:"section-title",children:"Status"}),(0,i.jsx)("div",{className:"status-badges",children:(0,i.jsx)("span",{className:"badge badge-".concat(h.status),children:h.status})})]}),(0,i.jsx)("div",{className:"order-card-footer",children:(0,i.jsx)("button",{type:"button",className:"btn-sm btn-primary",onClick:()=>u(h),children:"Update Order"})})]})}function l(e){let{imageUrl:s,onClose:a}=e,[n,d]=(0,t.useState)(!0);return(0,i.jsx)("div",{className:"modal-overlay",onClick:a,children:(0,i.jsxs)("div",{className:"image-modal",onClick:e=>e.stopPropagation(),children:[(0,i.jsx)("button",{type:"button",className:"modal-close",onClick:a,"aria-label":"Close",children:"✕"}),(0,i.jsxs)("div",{className:"image-container",children:[n&&(0,i.jsx)("div",{className:"image-loading",children:"Loading image..."}),(0,i.jsx)("img",{src:s,alt:"Payment proof",onLoad:()=>d(!1),className:n?"hidden":""})]})]})})}let r=["pending","processing","shipped","delivered","cancelled"],c=["pending","paid","unverified","failed"],o=["pending","verified","rejected"];function m(e){var s,a,d,m,h,u;let{order:p,onClose:v,onSuccess:x}=e,[j,g]=(0,t.useState)((null==p?void 0:p.status)||""),[N,y]=(0,t.useState)((null==p?void 0:p.paymentStatus)||""),[b,f]=(0,t.useState)((null==p?void 0:p.paymentVerificationStatus)||""),[S,C]=(0,t.useState)(!1),[P,A]=(0,t.useState)(""),[k,O]=(0,t.useState)(!1),[w,D]=(0,t.useState)(!1),L=async e=>{if(e.preventDefault(),!j&&!N&&!b){A("Update at least one field");return}A(""),C(!0);try{let e={};j&&(e.status=j),N&&(e.paymentStatus=N),b&&(e.paymentVerificationStatus=b),await n.Nq.updateOrderStatus(p._id,e),null==x||x()}catch(e){var s,a;A((null===(a=e.response)||void 0===a?void 0:null===(s=a.data)||void 0===s?void 0:s.message)||"Failed to update")}finally{C(!1)}},U=async()=>{if(confirm("Are you sure you want to delete this order? This cannot be undone.")){A(""),D(!0);try{await n.Nq.deleteOrder(p._id),null==x||x()}catch(a){var e,s;A((null===(s=a.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.message)||"Failed to delete order"),D(!1)}}};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"modal-overlay",onClick:v,children:(0,i.jsxs)("div",{className:"modal",onClick:e=>e.stopPropagation(),children:[(0,i.jsxs)("div",{className:"modal-header",children:[(0,i.jsxs)("h3",{children:["Update Order #",null==p?void 0:null===(s=p._id)||void 0===s?void 0:s.slice(-8)]}),(0,i.jsx)("button",{type:"button",className:"modal-close",onClick:v,"aria-label":"Close",children:"✕"})]}),(0,i.jsxs)("form",{onSubmit:L,className:"modal-body",children:[P&&(0,i.jsx)("div",{className:"form-error",children:P}),p.shippingAddress&&(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Shipping Information"}),(0,i.jsxs)("div",{className:"read-only-text",children:[(0,i.jsx)("div",{children:(0,i.jsx)("strong",{children:p.shippingAddress.name})}),(0,i.jsx)("div",{children:p.shippingAddress.address}),(0,i.jsxs)("div",{children:[p.shippingAddress.city,", ",p.shippingAddress.state," ",p.shippingAddress.zipCode]}),(0,i.jsxs)("div",{children:["Phone: ",p.shippingAddress.phone]}),(0,i.jsxs)("div",{children:["Email: ",p.shippingAddress.email]})]})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsxs)("label",{children:["Items (",(null===(a=p.items)||void 0===a?void 0:a.length)||0,")"]}),(0,i.jsx)("div",{className:"space-y-2",children:null===(d=p.items)||void 0===d?void 0:d.map((e,s)=>{var a,t;return(0,i.jsxs)("div",{className:"item-summary",children:[(0,i.jsx)("div",{children:(null===(a=e.product)||void 0===a?void 0:a.name)||e.product}),(0,i.jsxs)("div",{className:"text-right",children:[(0,i.jsxs)("div",{children:["Qty: ",e.quantity]}),(0,i.jsx)("div",{children:(null===(t=e.product)||void 0===t||t.name,"")}),(0,i.jsxs)("div",{className:"item-price",children:["Rs.",Number(e.price||0).toLocaleString()]})]})]},s)})})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Order Status"}),(0,i.jsxs)("select",{value:j,onChange:e=>g(e.target.value),children:[(0,i.jsx)("option",{value:"",children:"Select status..."}),r.map(e=>(0,i.jsx)("option",{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e))]})]}),"ONLINE"!==p.paymentMethod&&(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Payment Status"}),(0,i.jsxs)("select",{value:N,onChange:e=>y(e.target.value),children:[(0,i.jsx)("option",{value:"",children:"Select payment status..."}),c.map(e=>(0,i.jsx)("option",{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e))]}),(0,i.jsx)("small",{children:'Mark "paid" when customer pays on delivery.'})]}),"ONLINE"===p.paymentMethod&&(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Payment Verification"}),(0,i.jsxs)("select",{value:b,onChange:e=>f(e.target.value),children:[(0,i.jsx)("option",{value:"",children:"Select verification status..."}),o.map(e=>(0,i.jsx)("option",{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e))]}),(0,i.jsx)("small",{children:"Verify or reject uploaded payment screenshots for online payments."})]}),((null===(m=p.paymentProof)||void 0===m?void 0:m.data)||p.paymentScreenshot)&&(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Payment Proof"}),(0,i.jsxs)("button",{type:"button",className:"screenshot-button",onClick:()=>O(!0),children:[(0,i.jsx)("img",{src:(null===(h=p.paymentProof)||void 0===h?void 0:h.data)||p.paymentScreenshot,alt:"payment",className:"screenshot-thumb"}),(0,i.jsx)("span",{children:"Click to view full size"})]})]}),(0,i.jsxs)("div",{className:"modal-footer",children:[(0,i.jsx)("button",{type:"button",className:"btn-secondary btn-danger-secondary",onClick:U,disabled:w,children:w?"Deleting...":"Delete Order"}),(0,i.jsxs)("div",{style:{marginLeft:"auto",display:"flex",gap:"12px"},children:[(0,i.jsx)("button",{type:"button",className:"btn-secondary",onClick:v,children:"Cancel"}),(0,i.jsx)("button",{type:"submit",className:"btn-primary",disabled:S,children:S?"Updating...":"Update"})]})]})]})]})}),k&&(0,i.jsx)(l,{imageUrl:(null===(u=p.paymentProof)||void 0===u?void 0:u.data)||p.paymentScreenshot,onClose:()=>O(!1)})]})}function h(){var e;let[s,a]=(0,t.useState)([]),[r,c]=(0,t.useState)({}),[o,h]=(0,t.useState)(!0),[u,p]=(0,t.useState)(null),[v,x]=(0,t.useState)(""),[j,g]=(0,t.useState)(""),[N,y]=(0,t.useState)(1),[b,f]=(0,t.useState)(null),[S,C]=(0,t.useState)(!1),P=(0,t.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;h(!0);let s={page:e,limit:20};v&&(s.status=v),j&&(s.paymentStatus=j),n.Nq.getOrders(s).then(e=>{var s;(null===(s=e.data)||void 0===s?void 0:s.success)&&(a(e.data.data||[]),c(e.data.meta||{}))}).catch(e=>{var s,a;return p((null===(a=e.response)||void 0===a?void 0:null===(s=a.data)||void 0===s?void 0:s.message)||"Failed to load orders")}).finally(()=>h(!1))},[v,j]),A=e=>{e>=1&&e<=(r.pages||1)&&(y(e),P(e))};(0,t.useEffect)(()=>{y(1),P(1)},[P]);let k=async(e,s)=>{try{await n.Nq.verifyOrder(e,s),P(N)}catch(e){var a,i;alert((null===(i=e.response)||void 0===i?void 0:null===(a=i.data)||void 0===a?void 0:a.message)||"Failed to verify order")}};return o&&0===s.length?(0,i.jsx)("div",{className:"loading-state",children:"Loading orders..."}):u&&0===s.length?(0,i.jsx)("div",{className:"error-state",children:u}):(0,i.jsxs)("div",{className:"orders-page",children:[(0,i.jsxs)("div",{className:"filters-section",children:[(0,i.jsxs)("div",{className:"filter-group",children:[(0,i.jsx)("label",{children:"Status:"}),(0,i.jsxs)("select",{value:v,onChange:e=>x(e.target.value),children:[(0,i.jsx)("option",{value:"",children:"All Statuses"}),(0,i.jsx)("option",{value:"pending",children:"Pending"}),(0,i.jsx)("option",{value:"processing",children:"Processing"}),(0,i.jsx)("option",{value:"shipped",children:"Shipped"}),(0,i.jsx)("option",{value:"delivered",children:"Delivered"}),(0,i.jsx)("option",{value:"cancelled",children:"Cancelled"})]})]}),(0,i.jsxs)("div",{className:"filter-group",children:[(0,i.jsx)("label",{children:"Payment Status:"}),(0,i.jsxs)("select",{value:j,onChange:e=>g(e.target.value),children:[(0,i.jsx)("option",{value:"",children:"All Payments"}),(0,i.jsx)("option",{value:"pending",children:"Pending"}),(0,i.jsx)("option",{value:"paid",children:"Paid"}),(0,i.jsx)("option",{value:"failed",children:"Failed"})]})]})]}),0===s.length?(0,i.jsxs)("div",{className:"empty-state",children:[(0,i.jsx)("div",{className:"empty-icon",children:"\uD83D\uDCED"}),(0,i.jsx)("h3",{children:"No orders found"}),(0,i.jsx)("p",{children:"Try adjusting your filters or check back later."})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"orders-cards",children:s.map(e=>(0,i.jsx)(d,{order:e,onUpdate:f},e._id))}),(0,i.jsx)("div",{className:"orders-table",children:(0,i.jsx)("div",{className:"table-container",children:(0,i.jsxs)("table",{className:"admin-table",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Order ID"}),(0,i.jsx)("th",{children:"Customer"}),(0,i.jsx)("th",{children:"Items"}),(0,i.jsx)("th",{children:"Total"}),(0,i.jsx)("th",{children:"Payment"}),(0,i.jsx)("th",{children:"Status"}),(0,i.jsx)("th",{children:"Verification"}),(0,i.jsx)("th",{children:"Date"}),(0,i.jsx)("th",{children:"Actions"})]})}),(0,i.jsx)("tbody",{children:s.map(e=>{var s,a,t,n,d,l,r;return(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:(0,i.jsx)("code",{children:null===(s=e._id)||void 0===s?void 0:s.slice(-8)})}),(0,i.jsx)("td",{children:(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:(null===(a=e.shippingAddress)||void 0===a?void 0:a.name)||(null===(t=e.user)||void 0===t?void 0:t.name)||"-"}),(0,i.jsx)("br",{}),(0,i.jsx)("small",{children:(null===(n=e.shippingAddress)||void 0===n?void 0:n.phone)||(null===(d=e.user)||void 0===d?void 0:d.phone)||"-"})]})}),(0,i.jsx)("td",{children:(null===(l=e.items)||void 0===l?void 0:l.length)||0}),(0,i.jsxs)("td",{children:["Rs.",Number(e.totalAmount||0).toLocaleString()]}),(0,i.jsxs)("td",{children:[(0,i.jsx)("span",{className:"badge badge-pending",children:"ONLINE"===e.paymentMethod?"Online":"COD"}),"ONLINE"===e.paymentMethod&&((null===(r=e.paymentProof)||void 0===r?void 0:r.data)||e.paymentScreenshot)&&(0,i.jsxs)("div",{style:{marginTop:"8px",display:"flex",flexDirection:"column",gap:"4px"},children:[(0,i.jsx)("button",{type:"button",className:"btn-text",onClick:()=>{f(e),C(!0)},children:"View Screenshot"}),"unverified"===e.paymentStatus&&(0,i.jsxs)("div",{style:{display:"flex",gap:"4px"},children:[(0,i.jsx)("button",{type:"button",className:"btn-sm btn-success",onClick:()=>k(e._id,"verified"),children:"✅ Paid"}),(0,i.jsx)("button",{type:"button",className:"btn-sm btn-danger",onClick:()=>k(e._id,"rejected"),children:"❌ Invalid"})]})]})]}),(0,i.jsx)("td",{children:(0,i.jsx)("span",{className:"badge badge-".concat(e.status),children:e.status})}),(0,i.jsx)("td",{children:(0,i.jsx)("span",{className:"badge badge-verification-".concat(e.paymentVerificationStatus||"pending"),children:e.paymentVerificationStatus||"pending"})}),(0,i.jsx)("td",{style:{fontSize:"0.85rem"},children:new Date(e.createdAt).toLocaleDateString()}),(0,i.jsx)("td",{children:(0,i.jsx)("button",{type:"button",className:"btn-sm btn-primary",onClick:()=>f(e),children:"Update"})})]},e._id)})})]})})})]}),r.pages>1&&(0,i.jsxs)("div",{className:"pagination",children:[(0,i.jsx)("button",{type:"button",className:"btn-sm",disabled:N<=1||o,onClick:()=>A(N-1),children:"← Previous"}),(0,i.jsxs)("span",{children:["Page ",r.page," of ",r.pages," (",r.total," total)"]}),(0,i.jsx)("button",{type:"button",className:"btn-sm",disabled:N>=r.pages||o,onClick:()=>A(N+1),children:"Next →"})]}),b&&!S&&(0,i.jsx)(m,{order:b,onClose:()=>f(null),onSuccess:()=>{f(null),C(!1),P(N)}}),b&&S&&(0,i.jsx)(l,{imageUrl:(null===(e=b.paymentProof)||void 0===e?void 0:e.data)||b.paymentScreenshot,onClose:()=>{f(null),C(!1)}})]})}},5864:function(e,s,a){"use strict";a.d(s,{Nq:function(){return d}});let i=a(3464).Z.create({baseURL:"http://localhost:5000/api",headers:{"Content-Type":"application/json"}}),t=["/admin/auth/me","/admin/dashboard","/admin/products","/admin/orders","/admin/users"],n=e=>t.some(s=>null==e?void 0:e.includes(s));i.interceptors.request.use(e=>{{let s=localStorage.getItem("adminToken");if(n(e.url)&&!s)return window.location.href="/login",Promise.reject(Error("Admin authentication required"));s&&(e.headers.Authorization="Bearer ".concat(s))}return e}),i.interceptors.response.use(e=>e,e=>{var s;let a=null===(s=e.response)||void 0===s?void 0:s.status;return(401===a||403===a)&&(localStorage.removeItem("adminToken"),localStorage.removeItem("adminUser"),window.location.href="/login"),Promise.reject(e)});let d={login:(e,s)=>i.post("/admin/auth/login",{email:e,password:s}),getMe:()=>i.get("/admin/auth/me"),getStats:()=>i.get("/admin/dashboard/stats"),getProducts:()=>i.get("/admin/products"),createProduct:e=>i.post("/admin/products",e),updateProduct:(e,s)=>i.put("/admin/products/".concat(e),s),deleteProduct:e=>i.delete("/admin/products/".concat(e)),getOrders:e=>i.get("/admin/orders",{params:e}),updateOrderStatus:(e,s)=>i.put("/admin/orders/".concat(e),s),verifyOrder:(e,s)=>i.patch("/admin/orders/".concat(e,"/verify"),{status:s}),deleteOrder:e=>i.delete("/admin/orders/".concat(e)),getUsers:()=>i.get("/admin/users"),updateUser:(e,s)=>i.put("/admin/users/".concat(e),s),deleteUser:e=>i.delete("/admin/users/".concat(e))}}},function(e){e.O(0,[464,971,117,744],function(){return e(e.s=5417)}),_N_E=e.O()}]);
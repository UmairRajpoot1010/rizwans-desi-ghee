(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{7743:function(e,t,n){Promise.resolve().then(n.bind(n,738))},9376:function(e,t,n){"use strict";var a=n(5475);n.o(a,"usePathname")&&n.d(t,{usePathname:function(){return a.usePathname}}),n.o(a,"useRouter")&&n.d(t,{useRouter:function(){return a.useRouter}})},738:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return s}});var a=n(7437),r=n(2265),i=n(9376),o=n(2950);function s(){let e=(0,i.useRouter)(),{login:t,isAuthenticated:n,loading:s}=(0,o.a)(),[l,d]=(0,r.useState)(""),[u,c]=(0,r.useState)(""),[m,g]=(0,r.useState)(""),[v,h]=(0,r.useState)(!1);(0,r.useEffect)(()=>{!s&&n&&e.replace("/dashboard")},[s,n,e]);let p=async n=>{var a,r,i,o;n.preventDefault(),g(""),h(!0);try{let n=await t(l.trim(),u);(null==n?void 0:n.success)?e.replace("/dashboard"):g(null!==(r=null!==(a=null==n?void 0:n.message)&&void 0!==a?a:null==n?void 0:n.error)&&void 0!==r?r:"Invalid credentials")}catch(e){g((null===(o=e.response)||void 0===o?void 0:null===(i=o.data)||void 0===i?void 0:i.message)||"Login failed. Please try again.")}finally{h(!1)}};return s?(0,a.jsx)("main",{className:"login-page",children:(0,a.jsx)("div",{className:"login-container",children:(0,a.jsx)("p",{children:"Loading..."})})}):(0,a.jsx)("main",{className:"login-page",children:(0,a.jsxs)("div",{className:"login-container",children:[(0,a.jsx)("h1",{children:"Admin Login"}),(0,a.jsx)("p",{className:"login-subtitle",children:"Rizwan's Desi Ghee"}),(0,a.jsxs)("form",{onSubmit:p,children:[m&&(0,a.jsx)("div",{className:"login-error",children:m}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"email",children:"Email"}),(0,a.jsx)("input",{id:"email",type:"email",name:"email",value:l,onChange:e=>d(e.target.value),required:!0,autoComplete:"email",disabled:v})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"password",children:"Password"}),(0,a.jsx)("input",{id:"password",type:"password",name:"password",value:u,onChange:e=>c(e.target.value),required:!0,autoComplete:"current-password",disabled:v})]}),(0,a.jsx)("button",{type:"submit",disabled:v,children:v?"Signing in...":"Login"})]})]})})}},2950:function(e,t,n){"use strict";n.d(t,{AuthProvider:function(){return s},a:function(){return l}});var a=n(7437),r=n(2265),i=n(5864);let o=(0,r.createContext)(null);function s(e){let{children:t}=e,[n,s]=(0,r.useState)(null),[l,d]=(0,r.useState)(!0),u=(0,r.useCallback)(()=>{let e=localStorage.getItem("adminToken"),t=localStorage.getItem("adminUser");if(e&&t)try{return{token:e,admin:JSON.parse(t)}}catch(e){localStorage.removeItem("adminToken"),localStorage.removeItem("adminUser")}return null},[]),c=(0,r.useCallback)(()=>{localStorage.removeItem("adminToken"),localStorage.removeItem("adminUser"),s(null),window.location.href="/login"},[]),m=(0,r.useCallback)(async()=>{if(!u()){d(!1);return}try{let e=await i.Nq.getMe(),t=null==e?void 0:e.data,n=null==t?void 0:t.data;if(!(null==t?void 0:t.success)||!n){c();return}let a=(n.role||"").toLowerCase();if("admin"!==a&&"superadmin"!==a){c();return}s(n),localStorage.setItem("adminUser",JSON.stringify(n))}catch(e){c()}finally{d(!1)}},[u,c]);(0,r.useEffect)(()=>{m()},[m]);let g=async(e,t)=>{var n,a,r,o,l,d,u;try{let o=await i.Nq.login(e,t),l=null==o?void 0:o.data,d=null==l?void 0:l.data;if(console.log("Login Response:",{success:null==l?void 0:l.success,role:null==d?void 0:null===(n=d.admin)||void 0===n?void 0:n.role}),!(null==l?void 0:l.success)||!(null==d?void 0:d.token)||!(null==d?void 0:d.admin))return{success:!1,message:null!==(r=null==l?void 0:l.message)&&void 0!==r?r:"Login failed"};let u=String((null===(a=d.admin)||void 0===a?void 0:a.role)||"").toLowerCase();if("admin"!==u&&"superadmin"!==u)return console.error("Access Denied: Invalid role",u),{success:!1,message:"Access denied. Admin or superadmin role required."};return localStorage.setItem("adminToken",d.token),localStorage.setItem("adminUser",JSON.stringify(d.admin)),s(d.admin),{success:!0}}catch(e){return{success:!1,message:null!==(u=null!==(d=null==e?void 0:null===(l=e.response)||void 0===l?void 0:null===(o=l.data)||void 0===o?void 0:o.message)&&void 0!==d?d:null==e?void 0:e.message)&&void 0!==u?u:"Login failed"}}},v=!!n&&("admin"===n.role||"superadmin"===n.role);return(0,a.jsx)(o.Provider,{value:{admin:n,loading:l,login:g,logout:c,isAuthenticated:v},children:t})}function l(){let e=(0,r.useContext)(o);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},5864:function(e,t,n){"use strict";n.d(t,{Nq:function(){return o}});let a=n(3464).Z.create({baseURL:"http://localhost:5000/api",headers:{"Content-Type":"application/json"}}),r=["/admin/auth/me","/admin/dashboard","/admin/products","/admin/orders","/admin/users"],i=e=>r.some(t=>null==e?void 0:e.includes(t));a.interceptors.request.use(e=>{{let t=localStorage.getItem("adminToken");if(i(e.url)&&!t)return window.location.href="/login",Promise.reject(Error("Admin authentication required"));t&&(e.headers.Authorization="Bearer ".concat(t))}return e}),a.interceptors.response.use(e=>e,e=>{var t;let n=null===(t=e.response)||void 0===t?void 0:t.status;return(401===n||403===n)&&(localStorage.removeItem("adminToken"),localStorage.removeItem("adminUser"),window.location.href="/login"),Promise.reject(e)});let o={login:(e,t)=>a.post("/admin/auth/login",{email:e,password:t}),getMe:()=>a.get("/admin/auth/me"),getStats:()=>a.get("/admin/dashboard/stats"),getProducts:()=>a.get("/admin/products"),createProduct:e=>a.post("/admin/products",e),updateProduct:(e,t)=>a.put("/admin/products/".concat(e),t),deleteProduct:e=>a.delete("/admin/products/".concat(e)),getOrders:e=>a.get("/admin/orders",{params:e}),updateOrderStatus:(e,t)=>a.put("/admin/orders/".concat(e),t),verifyOrder:(e,t)=>a.patch("/admin/orders/".concat(e,"/verify"),{status:t}),deleteOrder:e=>a.delete("/admin/orders/".concat(e)),getUsers:()=>a.get("/admin/users"),updateUser:(e,t)=>a.put("/admin/users/".concat(e),t),deleteUser:e=>a.delete("/admin/users/".concat(e))}}},function(e){e.O(0,[464,971,117,744],function(){return e(e.s=7743)}),_N_E=e.O()}]);